```plantuml
@startuml Arquitetura BetAware API - Camadas

!theme aws-orange
skinparam backgroundColor #F8F9FA
skinparam package {
    BackgroundColor #FFFFFF
    BorderColor #2C3E50
    FontSize 12
}

title **Arquitetura em Camadas - BetAware API**\n**Spring Boot 3.x + Spring Security + JWT**

package "**ğŸŒ Presentation Layer**" #E3F2FD {
    
    package "Controllers (REST)" {
        class AuthController {
            + login(LoginRequest): ResponseEntity<JwtResponse>
            + register(RegisterRequest): ResponseEntity<Void>
            --
            ğŸ“ /v1/auth/**
        }
        
        class ApostaController {
            + criarAposta(ApostaDTO): ResponseEntity<ApostaDTO>
            + listarApostas(): ResponseEntity<List<ApostaDTO>>
            + listarPorPeriodo(): ResponseEntity<List<ApostaDTO>>
            --
            ğŸ“ /v1/apostas/**
            ğŸ”’ Requer autenticaÃ§Ã£o JWT
        }
        
        class HealthController {
            + healthCheck(): ResponseEntity<String>
            --
            ğŸ“ /v1/health
        }
        
        class DebugController {
            + getDatabaseInfo(): ResponseEntity<Map>
            --
            ğŸ“ /v1/debug/**
        }
    }
    
    package "DTOs (Data Transfer)" {
        class ApostaDTO
        class LoginRequest  
        class RegisterRequest
        class JwtResponse
        class ErroResponse
    }
}

package "**ğŸ” Security Layer**" #FFF3E0 {
    class SecurityConfig {
        + securityFilterChain(): SecurityFilterChain
        + corsConfigurationSource(): CorsConfigurationSource
        + passwordEncoder(): BCryptPasswordEncoder
    }
    
    class JwtAuthenticationFilter {
        + doFilterInternal(): void
        --
        Intercepta requisiÃ§Ãµes e
        valida tokens JWT
    }
    
    class JwtTokenProvider {
        + generateToken(): String
        + validateToken(): boolean
        + getUsernameFromToken(): String
    }
    
    class CustomUserDetailsService {
        + loadUserByUsername(): UserDetails
        --
        Carrega usuÃ¡rio do banco
        para autenticaÃ§Ã£o
    }
}

package "**âš™ï¸ Business Layer**" #E8F5E8 {
    class AuthService {
        + login(LoginRequest): JwtResponse
        + register(RegisterRequest): void
        --
        ğŸ”’ AutenticaÃ§Ã£o e registro
        ğŸ›¡ï¸ ValidaÃ§Ãµes de negÃ³cio
    }
    
    class ApostaService {
        + criarAposta(): ApostaDTO
        + listarApostasPorUsuario(): List<ApostaDTO>
        + listarPorPeriodo(): List<ApostaDTO>
        --
        ğŸ“Š Regras de negÃ³cio das apostas
        ğŸ” Filtros e consultas
    }
}

package "**ğŸ’¾ Data Access Layer**" #FCE4EC {
    interface UsuarioRepository {
        + findByUsername(): Optional<Usuario>
        + findByEmail(): Optional<Usuario>
        + existsByUsername(): boolean
        + existsByEmail(): boolean
        + existsByCpf(): boolean
        --
        ğŸ“¦ JpaRepository<Usuario, Long>
    }
    
    interface ApostaRepository {
        + findByUsuarioUsernameOrderByDataDesc(): List<Aposta>
        + findByDataBetween(): List<Aposta>
        + findByUsuarioAndDataBetween(): List<Aposta>
        --
        ğŸ“¦ JpaRepository<Aposta, Long>
    }
}

package "**ğŸ—ƒï¸ Model Layer**" #F3E5F5 {
    class Usuario {
        - Entidade JPA
        - UserDetails (Spring Security)
        - ValidaÃ§Ãµes Bean Validation
    }
    
    class Aposta {
        - Entidade JPA  
        - Relacionamento @ManyToOne
        - ValidaÃ§Ãµes de negÃ³cio
    }
    
    enum Perfil
    enum ResultadoAposta
}

package "**âš ï¸ Exception Handling**" #FFEBEE {
    class GlobalExceptionHandler {
        + handleValidationExceptions()
        + handleBadCredentialsException()
        + handleUsuarioJaExisteException()
        + handleRecursoNaoEncontradoException()
        --
        ğŸ¯ @RestControllerAdvice
        ğŸ“‹ PadronizaÃ§Ã£o de erros
    }
    
    class UsuarioJaExisteException
    class RecursoNaoEncontradoException  
    class NegocioException
}

package "**ğŸ”§ Configuration**" #E0F2F1 {
    class OpenApiConfig {
        + customOpenAPI(): OpenAPI
        --
        ğŸ“š Swagger/OpenAPI 3
        ğŸ”‘ JWT Security Schema
    }
    
    class CorsConfig {
        + corsFilter(): CorsFilter
        --
        ğŸŒ ConfiguraÃ§Ã£o CORS
        ğŸ“± Suporte para Mobile/Web
    }
    
    class DataInitializer {
        + loadData(): CommandLineRunner
        --
        ğŸ—ï¸ Dados iniciais para testes
    }
}

' === RELACIONAMENTOS ENTRE CAMADAS ===

' Controllers -> Services
AuthController --> AuthService : usa
ApostaController --> ApostaService : usa

' Services -> Repositories  
AuthService --> UsuarioRepository : acessa
ApostaService --> UsuarioRepository : acessa
ApostaService --> ApostaRepository : acessa

' Security -> Services
SecurityConfig --> JwtAuthenticationFilter : configura
JwtAuthenticationFilter --> JwtTokenProvider : usa
JwtAuthenticationFilter --> CustomUserDetailsService : usa
CustomUserDetailsService --> UsuarioRepository : consulta
AuthService --> JwtTokenProvider : gera tokens

' Services -> Models
AuthService --> Usuario : manipula
ApostaService --> Usuario : consulta
ApostaService --> Aposta : manipula

' Controllers -> DTOs
AuthController --> LoginRequest : recebe
AuthController --> RegisterRequest : recebe  
AuthController --> JwtResponse : retorna
ApostaController --> ApostaDTO : usa

' Exception Handling
GlobalExceptionHandler --> ErroResponse : retorna
AuthService --> UsuarioJaExisteException : lanÃ§a
ApostaService --> RecursoNaoEncontradoException : lanÃ§a

' Notas explicativas
note right of SecurityConfig
    **ConfiguraÃ§Ã£o Principal de SeguranÃ§a**
    â€¢ JWT Stateless Authentication
    â€¢ CORS para Mobile/Web
    â€¢ Endpoints pÃºblicos e protegidos
end note

note bottom of GlobalExceptionHandler  
    **InterceptaÃ§Ã£o Global de ExceÃ§Ãµes**
    â€¢ Respostas padronizadas
    â€¢ Status HTTP apropriados
    â€¢ Mensagens user-friendly
end note

@enduml
```
